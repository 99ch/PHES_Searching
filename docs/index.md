layout: page
title: "PHES_Searching"
permalink: /PHES_Searching/

# How to use PHES searching software

## Input

### Storage Location
In the home directory of the PHES_Searching folder there should be a file called storage_location. In this file there should be a single line describing the path to the input/output folder in the format “file_storage_location = <path to storage location>;”. For example, to use the same PHES_Searching folder, use “file_storage_location = ../PHES_Searching/;” or for the folder on the pv network drive at ANU use “file_storage_location = ../../../../../p/PHES_Searching/;”.
This location will be referred to as <storage location> hereafter.
To use a network location, first ensure the computer is connected to the server (Can be accessed through windows explorer). Then in either linux bash or ubuntu (either can be installed on a windows computer), mount the server to the p drive using “sudo mount -t drvfs  \\\\piso.cecs.anu.edu.au\\pv /mnt/p/” (Adjust as needed for an alternate system).
### Digital Elevation Model
Place all required DEM files (1 degree by 1 degree with 1 arcsecond resolution supported, other resolutions unknown) in the <storage location>/input/DEMs folder with filename <latitude>_<longitude>_1arc_v3.tif (e.g. n00_e000_1arc_v3.tif).

### Shapefile Exclusions (Filters)
If required, place all shapefile exclusions (filters) in the <storage location>/input folder and add them as filters in the variables file (See below). For faster runtimes on bulk runs, see generating shapefile tiles below.
### Existing Reservoirs
__NOTE: This is only required for brownfield searching, steps below can be ignored for purely off-river searching.__

#### Shapefile
Place the shapefile containing all existing reservoirs to be checked in the <storage location>/input/existing_reservoirs folder and add its filename as the existing_reservoirs_shp in the variables file (See below).
#### CSV Data
Place the csv spreadsheet containing information about the reservoirs to be tested in the <storage location>/input/existing_reservoirs folder and add its filename as the existing_reservoirs_csv in the variables file (See below).
A header row must be present, and columns must match the columns in the image below.

<!-- TODO add image -->

#### Names
Place the spreadsheet containing the reservoir names corresponding to the polygons in the shapefile in the order they occur in the shape files (All polygons must be included, details on generating this file from the dbf are outlined below) in the <storage location>/input/existing_reservoirs folder and add its filename as the existing_reservoirs_shp_names in the variables file (See below).
A header row must be present, and columns must match the columns in the image below.

<!-- TODO add image -->

##### Generating names csv from dbf
The csv with a list of names can be generated by using excel to open the dbf file attached to the shapefile of existing reservoirs, finding the column that corresponds to the name and copy and pasting it into a new file (As seen above).

#### To run
Run pairing both with 
Bin/pairing “RESERVOIR NAME” 1
Bin/pairing <long> <lat> 1

<!-- TODO move to single run -->


## Variables 

All variables that can be adjusted are in the variables file in the home directory of <storage location> and are briefly outlined in the table below. Each line is in the format <variable> = <value>; and // is treated as a comment (Similar to C++ formatting).

<!-- TODO add table -->

## Generating Shapefile Tiles 
Ensure filters to tile are set as variables using filter_to_tile = <filename>; in the variables file at <storage location>. Running shapefile_tiling (use ./bin/shapefile_tiling in bash) will then generate shapefile tiles (Subsets of the polygons) for each of the cells in the task list.

## Single Run
To run a single process, use either ./bin/<process> <lon> <lat> for greenfield searching of a DEM square or ./bin/<process> “<existing reservoir name>” for a brownfield site. <lon> and <lat> should be specified as integers between -180 to 180 and -90 to 90 respectively. DEMs and existing reservoirs must be run in the order screening -> pairing -> pretty_set -> constructor.

<!-- TODO update for cmake -->

## Bulk Run
__NOTE: Before a bulk run, delete <storage location>/driver_files and <storage location>/debug. If in <storage location> directory, can use make clean command instead (If make file present).__

To start a bulk run, ensure variables and tasks/processes files (see below) are set correctly, then use ./bin/search_driver to start one driver or make run n=<num processes> to start several drivers in parallel. The drivers will automatically go through the tasks and processes, storing any error information (See debug below) and will output done when all tasks are complete.

### Tasks File 
The tasks file (filename specified in variables) contains a list of all the tasks to complete (DEM squares or existing reservoir names). This is a text file with one task per line in the format <lon> <lat> for a DEM square or “<reservoir name>” for an existing reservoir. For example:

<!-- TODO add image -->

### Processes File

The processes file (filename specified in variables) contains a list of all the processes to complete (Out of screening, pairing, pretty_set and constructor). This is a text file with one process per line. For example:

<!-- TODO add image -->
